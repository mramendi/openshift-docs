// This module is included in the following assemblies:
// * about/op-release-notes.adoc

:_mod-docs-content-type: REFERENCE
[id="op-release-notes-1-13_{context}"]
= Release notes for {pipelines-title} General Availability 1.13

With this update, {pipelines-title} General Availability (GA) 1.13 is available on {OCP} 4.12 and later versions.

[id="new-features-1-13_{context}"]
== New features

In addition to fixes and stability improvements, the following sections highlight what is new in {pipelines-title} 1.13:

[NOTE]
====
Before upgrading to the {pipelines-title} Operator 1.13, ensure that you installed at least the {OCP} 4.12.19 or 4.13.1 version on your cluster.
====

[id="pipelines-new-features-1-13_{context}"]
=== Pipelines

* Before this update, the Source-to-Image (S2I) cluster tasks used a base S2I container image that was in Technology Preview. With this update, the S2I cluster tasks used a base S2I container image that is released and fully supported.

* With this update, optionally, you can enable a setting so that, when a task run is cancelled, {pipelines-shortname} stops the pod for the task run but does not delete the pod. To enable this setting, in the `TektonConfig` custom resource (CR) set the `pipeline.options.configMaps.feature-flags.data.keep-pod-on-cancel` spec to `true` and the `pipeline.enable-api-fields` spec to `alpha`.

* Before this update, you had to enable alpha features in order to set compute resource limits on the task level. With this update, you can use the `computeResources` spec for a `TaskRun` CR to set the resource limits for a task.

* With this update, when specifying a task and using the `displayName` parameter, you can use parameters that include the values of parameters, results, or context variables in the display name, for example, `$(params.application)`, `$(tasks.scan.results.report)`, `$(context.pipeline.name)`.

* With this update, when specifying a remote pipeline or task using the hub resolver, in the `version` parameter you can use inequation constraints such as `>=0.2.0,< 1.0.0`.

* With this update, when specifying a task you can use a Common Expression Language (CEL) expression in the `when` expression. To use this feature, you must set the `pipeline.options.configMaps.feature-flags.data.enable-cel-in-whenexpression` spec to `true` in the `TektonConfig` CR.

* With this update, when specifying a pipeline in a `PipelineRun` CR spec, you can reference the results produced by an inline task in a subsequent inline task.
+
.Example usage
[source,yaml]
----
  apiVersion: tekton.dev/v1
  kind: Task
  metadata:
    name: uid-task
  spec:
    results:
      - name: uid
    steps:
      - name: uid
        image: alpine
        command: ["/bin/sh", "-c"]
        args:
          - echo "1001" | tee $(results.uid.path)
  ---
  apiVersion: tekton.dev/v1
  kind: PipelineRun
  metadata:
    name: uid-pipeline-run
  spec:
    pipelineSpec:
      tasks:
      - name: add-uid
        taskRef:
          name: uid-task
      - name: show-uid
        taskSpec:
          steps:
            - name: show-uid
              image: alpine
              command: ["/bin/sh", "-c"]
              args:
                - echo $(tasks.add-uid.results.uid)
----

* With this update, when configuring the cluster resolver, you can set the value of the `blocked-namespaces` parameter to `*`. With this setting, only the namespaces listed in the `allowed-namespaces` parameter are allowed and all other namespaces are blocked.

[id="operator-new-features-1-13_{context}"]
=== Operator

* With this update, the `disable-affinity-assistant` feature flag has been deprecated and might be removed in a future release. Instead, in the `TektonConfig` CR, you can set the `pipeline.options.configMaps.feature-flags.data.coschedule` spec to one of the following values:

** `workspaces`: {pipelines-shortname} schedules all task runs that share the same workspace to the same node if the workspace allocates a persistent volume claim. This is the default setting.
** `pipelineruns`: {pipelines-shortname} schedules all task runs in a pipeline run to the same node.
** `isolate-pipelinerun`: {pipelines-shortname} schedules all task runs in a pipeline run to the same node and allows only one pipeline run to run on a node at the same time. This setting might delay pipeline runs if all nodes are used for other pipeline runs.
** `disabled`: {pipelines-shortname} does not apply any specific policy about alocating task runs to nodes.

[id="triggers-new-features-1-13_{context}"]
=== Triggers

* Before this update, the core interceptor always created TLS secrets when starting. With this update, the core interceptor creates TLS secrets if a TLS secret is not present on the cluster or when a certificate in the existing secret has expired.

[id="cli-new-features-1-13_{context}"]
=== CLI

* With this update, when you use the `tkn bundle push` command, the bundle is created with the creation time set to `1970-01-01T00:00:00Z` (Unix epoch time). This change ensures that bundle images created from the same source are always identical. You can use the `--ctime` parameter to set the creation time in the RFC3339 format. You can also use the `SOURCE_DATE_EPOCH` environment variable to set the creation time.

[id="pac-new-features-1-13_{context}"]
=== {pac}

* With this update, in {pac}, when using a CEL expression for advanced event matching (pipelinesascode.tekton.dev/on-cel-expression), you can use the `header` and `body` fields to access the full payload that is passed by the Git repository provider body. You can use this feature to filter events by any information that the Git repository sends.
+
--
:FeatureName: Using the header and body of the payload in CEL expressions for event matching
include::snippets/technology-preview.adoc[]
--

* With this update, when a {pac} pipeline run is triggered by a push event, you can use `/test`, `/test branch:<branchname>`, `/retest`, `/retest branch:<branchname>`, `/cancel`, and `/cancel branch:<branchname>` commands on the corresponding commit comment to re-run or cancel the pipeline run.

* With this update, when using {pac}, you can use remote tasks on remote pipelines. Therefore, you can reuse a complete remote pipeline across multiple repositories. You can override tasks from the remote pipeline by adding a task with the same name.
+
--
:FeatureName: Using remote tasks on remote pipelines and overriding tasks
include::snippets/technology-preview.adoc[]
--

* With this update, when using {pac}, you can view improved information about CI pipeline runs in the Git repository provider. This information includes the namespace and the associated pipeline run.

[id="breaking-changes-1-13_{context}"]
== Breaking changes

* Before this update, in {pac}, when using a policy group, users who were not a part of policy groups and not allowed explicitly but allowed to run the CI  (via org ownership or otherwise) could sometimes execute pipeline runs by creating events such as pull requests or by entering commands such as `ok_to_test`. With this update, if policy groups are configured, only users that are added to the required policy groups can execute pipeline runs, and users that are a part of the owner organization but not configured in policy groups cannot execute pipeline runs.

[id="known-issues-1-13_{context}"]
== Known issues

* To enable keeping pods when a task run is cancelled, along with setting the `pipeline.options.configMaps.feature-flags.data.keep-pod-on-cancel` spec to `true` in the `TektonConfig` CR, you also need to set the `pipeline.enable-api-fields` spec to `alpha` in the `TektonConfig` CR.

* If you enable keeping pods when a task run is cancelled, when a task run is cancelled because of a default timeout or because you set a timeput in the pipeline specification, {pipelines-shortname} deletes the pod.

[id="fixed-issues-1-13_{context}"]
== Fixed issues

* Before this update, a secret that a pipeline run uses for Git authentication could be deleted from the cluster during a cleanup. With this update, a secret is deleted only when all pipeline runs that use it are deleted.

* Before this update, in cases where multiple secrets shared the same prefix and were logged using the git interface, sometimes the concealing process started with a shorter secret, and a part of a longer secret could be displayed in the logs. With this update, when concealing secrets in logs, the process now starts from the longest secret, ensuring that no part of any secret is displayed in the logs.

* Before this update, if you specified a `results` spec for a pipeline, the pipeline run could wrongly fail with a mismatched types error. With this update, if you specify a `results` spec for a pipeline, the results provided by the pipeline are correctly processed.

* Before this update, when {tekton-chains} was configured with KMS as Hashicorp Vault, the pod started crashing if there was an underlying error while connecting to Vault. This has now been fixed and the error is now recorded in the {tekton-chains} controller log.

* Before this update, when using {tekton-chains}, if you configured the `storage.oci.repository` parameter, errors were reported in the Tekton Chains controller log. With this update, the `storage.oci.repository` parameter is processed correctly.

* Before this update, when {tekton-chains} was configured with the Hashicorp Vault KMS and there was an issue with the connection to Vault, the {tekton-chains} controller pod could crash. With this update, the errors are processed and logged on the {tekton-chains} controller log.

[id="release-notes-1-13-1_{context}"]
== Release notes for {pipelines-title} General Availability 1.13.1

With this update, {pipelines-title} General Availability (GA) 1.13.1 is available on {OCP} 4.12 and later versions.

[id="fixed-issues-1-13-1_{context}"]
=== Fixed issues

* Before this update, a task run sometimes failed with a `cannot stop the sidecar` error message. With this update, the race condition between controllers that caused this failure is fixed.

* Before this update, to enable keeping pods when a task run is cancelled, along with setting the `pipeline.options.configMaps.feature-flags.data.keep-pod-on-cancel` spec to `true` in the `TektonConfig` CR, you also need to set the `pipeline.enable-api-fields` spec to `alpha` in the `TektonConfig` CR. With this update, setting the `pipeline.options.configMaps.feature-flags.data.keep-pod-on-cancel` spec to `true` in the `TektonConfig` CR enables keeping pods when a task run is cancelled, and no additional setting is necessary.

* Before this update, if you defined a sidecar for a task, {pipelines-shortname} did not validate the container image in the definition when creating the `Task` and `TaskRun` custom resources (CRs). At run time, a sidecar with an invalid container image caused the task run to fail. With this update, {pipelines-shortname} validates the container image in the sidecar definition when creating the `Task` and `TaskRun` CRs.

* Before this update, the {pipelines-shortname} controller sometimes crashed when the task was evaluating parameters. With this update, the controller no longer crashes.

* Before this update, if the final task in a pipeline run failed or was skipped, {pipelines-shortname} sometimes reported a validation error for the pipeline run. With this update, {pipelines-shortname} reports the status of the pipeline run correctly.

[id="release-notes-1-13-2_{context}"]
== Release notes for {pipelines-title} General Availability 1.13.2

With this update, {pipelines-title} General Availability (GA) 1.13.2 is available on {OCP} 4.12 and later versions.

[id="fixed-issues-1-13-2_{context}"]
=== Fixed issues

* Before this update, if you used a custom namespace to install Tekton Hub, the installation deleted the `openshift-pipelines` namespace, removing the {pipelines-shortname} installation. With this update, you can use a custom namespace to install Tekton Hub and your {pipelines-shortname} installation is unaffected
